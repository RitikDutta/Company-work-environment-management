<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Webcam Stream</title>
</head>
<body>
    <h1>Webcam Stream</h1>
    <video id="video" width="640" height="480" autoplay></video>
    <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
    <script>
        // Get the video element
        var video = document.getElementById('video');

        // Get the canvas element
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        // Constraints for the video stream
        var constraints = { audio: false, video: true };

        // Get the video stream
        navigator.mediaDevices.getUserMedia(constraints)
            .then(function(stream) {
                // Attach the video stream to the video element
                video.srcObject = stream;
            })
            .catch(function(error) {
                console.log('Error accessing webcam stream:', error);
            });

        // Send the video stream to Flask server
        setInterval(function() {
            // Draw the video frame on the canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Get the base64 encoded image data from the canvas
            var data = canvas.toDataURL();

            // Send the image data to Flask server using AJAX
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/process_video');
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onload = function() {
                console.log(xhr.responseText);
            };
            xhr.send(JSON.stringify({ data: data }));
        }, 100);
    </script>
</body>
</html>
